<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="/styles.css">
</head>
<body>
  <img src="/logo pic/logo opag.png" alt="OPAG Logo" style="height: 80px;">
  
  <form id="loginForm">
    <input type="text" placeholder="Username" required>
    <input type="password" placeholder="Password" required>
    <button type="submit">Login</button>
    <p id="error" style="color:red;"></p>
  </form>

  <script>
   document.getElementById('loginForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  
  const errorElement = document.getElementById('error');
  errorElement.textContent = '';
  
  try {
    const response = await fetch('/.netlify/functions/google-script-proxy', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        action: 'login',
        username: document.getElementById('username').value,
        password: document.getElementById('password').value
      })
    });

    // First check if response is OK
    if (!response.ok) {
      throw new Error(`HTTP error! status: ${response.status}`);
    }

    // Then try to parse as JSON
    const text = await response.text();
    let result;
    
    try {
      result = text ? JSON.parse(text) : {};
    } catch (parseError) {
      console.error("Failed to parse JSON:", text);
      throw new Error("Invalid server response");
    }

    if (result.error) {
      throw new Error(result.error);
    }
    
    // Login successful
    localStorage.setItem('user', JSON.stringify(result.user));
    window.location.href = '/index.html';
    
  } catch (error) {
    errorElement.textContent = error.message;
    console.error('Login error:', error);
  }
});
  </script>
</body>
</html>
